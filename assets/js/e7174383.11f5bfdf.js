"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[6303],{1788:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>x});const s=JSON.parse('{"id":"CSAPP and SJTU ICS/05 Function","title":"05 Function","description":"\u8fd9\u7bc7\u7b14\u8bb0\u4ecb\u7ecdlecture9\uff0c\u6c47\u7f16\u4e2d\u7684\u51fd\u6570\u3002","source":"@site/docs/CSAPP and SJTU ICS/05 Function.md","sourceDirName":"CSAPP and SJTU ICS","slug":"/CSAPP and SJTU ICS/05 Function","permalink":"/docs/CSAPP and SJTU ICS/05 Function","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CSAPP and SJTU ICS/05 Function.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"04 Jmp","permalink":"/docs/CSAPP and SJTU ICS/04 Jmp"},"next":{"title":"06 Array and Structure","permalink":"/docs/CSAPP and SJTU ICS/06 Array and Structure"}}');var l=r(4848),c=r(8453);const d={sidebar_position:1},i=void 0,a={},x=[{value:"\u51fd\u6570",id:"\u51fd\u6570",level:2},{value:"\u51fd\u6570\u8c03\u7528",id:"\u51fd\u6570\u8c03\u7528",level:3},{value:"\u8fd4\u56de",id:"\u8fd4\u56de",level:3},{value:"\u6808\u5e27\u7ed3\u6784",id:"\u6808\u5e27\u7ed3\u6784",level:3},{value:"\u4f20\u8f93\u6570\u636e",id:"\u4f20\u8f93\u6570\u636e",level:3},{value:"\u5bc4\u5b58\u5668\u4f7f\u7528\u7ea6\u5b9a",id:"\u5bc4\u5b58\u5668\u4f7f\u7528\u7ea6\u5b9a",level:3},{value:"\u5c40\u90e8\u53d8\u91cf",id:"\u5c40\u90e8\u53d8\u91cf",level:3},{value:"\u51fd\u6570\u603b\u7ed3",id:"\u51fd\u6570\u603b\u7ed3",level:3},{value:"\u9012\u5f52",id:"\u9012\u5f52",level:3}];function t(n){const e={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.p,{children:"\u8fd9\u7bc7\u7b14\u8bb0\u4ecb\u7ecdlecture9\uff0c\u6c47\u7f16\u4e2d\u7684\u51fd\u6570\u3002"}),"\n",(0,l.jsx)(e.h2,{id:"\u51fd\u6570",children:"\u51fd\u6570"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u51fd\u6570\u5b9e\u73b0\u4e2d\uff0c\u5305\u542b\u8bb8\u591a\u5904\u7406"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8c03\u7528\u51fd\u6570"}),"\n",(0,l.jsx)(e.li,{children:"\u8fd4\u56de"}),"\n",(0,l.jsx)(e.li,{children:"\u4f20\u9012\u6570\u636e"}),"\n",(0,l.jsx)(e.li,{children:"\u5bc4\u5b58\u5668"}),"\n",(0,l.jsx)(e.li,{children:"\u5c40\u90e8\u53d8\u91cf"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\u51fd\u6570\u8c03\u7528",children:"\u51fd\u6570\u8c03\u7528"}),"\n",(0,l.jsxs)(e.p,{children:["\u8c03\u7528\u51fd\u6570\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"call"})," \u6307\u4ee4\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-x86asm",children:"call label    # direct\ncall *operand # indirect\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"call"})," \u6307\u4ee4\u4f1a\u5c06\u8fd4\u56de\u5730\u5740\u5b58\u5165\u6808\u4e2d\uff0c\u5e76\u8df3\u5230\u51fd\u6570\u7684\u4ee3\u7801\u6bb5\u3002\u5177\u4f53\u5730\uff0c\u4f1a\u5c06 ",(0,l.jsx)(e.code,{children:"%rsp"})," \u7684\u503c\u964d\u4f4e\uff08push\uff09\uff0c ",(0,l.jsx)(e.code,{children:"%rip"})," \u7684\u503c\u4f1a\u88ab\u6539\u4e3a\u51fd\u6570\u4ee3\u7801\u7684\u4f4d\u7f6e\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"\u8fd4\u56de",children:"\u8fd4\u56de"}),"\n",(0,l.jsxs)(e.p,{children:["\u8fd4\u56de\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"ret"})," \uff08\u5df2\u5728ICS 03\u4e2d\u63d0\u5230\uff09\u3002"]}),"\n",(0,l.jsxs)(e.p,{children:["\u4e0e ",(0,l.jsx)(e.code,{children:"call"})," \u7c7b\u4f3c\uff0c ",(0,l.jsx)(e.code,{children:"ret"})," \u4f1a\u589e\u52a0 ",(0,l.jsx)(e.code,{children:"%rsp"})," \u7684\u503c\uff08pop\uff09\uff0c\u5c06 ",(0,l.jsx)(e.code,{children:"%rip"})," \u6539\u4e3a\u539f\u6765\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u5730\u5740\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"\u6808\u5e27\u7ed3\u6784",children:"\u6808\u5e27\u7ed3\u6784"}),"\n",(0,l.jsxs)(e.p,{children:["\u6808\u5e27\u7ed3\u6784\u6307\u4e3a\u7a0b\u5e8f\u5206\u914d\u7684\u6808\u90e8\u5206\uff0c ",(0,l.jsx)(e.code,{children:"%rsp"})," \u6307\u9488\u6307\u5411\u6808\u9876\u3002"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{alt:"stack frame",src:r(7193).A+"",width:"1421",height:"1045"})}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u8c03\u7528\u51fd\u6570\u65f6\uff0c\u4f1a\u5148\u5c06\u8fd4\u56de\u5730\u5740\u5165\u6808\uff0c\u7136\u540e\u6267\u884c\u51fd\u6570\uff0c\u5165\u6808\u6240\u9700\u91cf\u3002\u51fd\u6570\u7ed3\u675f\u540e\uff0c\u51fa\u6808\u76f4\u5230\u6267\u884c\u51fd\u6570\u4e4b\u524d\u7684\u4f4d\u7f6e\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"\u4f20\u8f93\u6570\u636e",children:"\u4f20\u8f93\u6570\u636e"}),"\n",(0,l.jsxs)(e.p,{children:["\u6839\u636e\u53c2\u6570\u7684\u5927\u5c0f\uff0c\u6709\u7279\u5b9a\u7684\u5bc4\u5b58\u5668\u50a8\u5b58\u53c2\u6570\u3002\u8fd4\u56de\u503c\u4e00\u822c\u4fdd\u5b58\u5728 ",(0,l.jsx)(e.code,{children:"%rax"})," \u4e2d\u3002"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{alt:"arguments",src:r(8342).A+"",width:"1020",height:"364"})}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u53c2\u6570\u591a\u4e8e\u516d\u4e2a\u7684\u65f6\u5019\uff0c\u53c2\u6570\u4f1a\u88ab\u50a8\u5b58\u5728\u6808\u4e2d\uff0c\u8fd4\u56de\u5730\u5740\u4e4b\u524d\u3002\u5176\u4e2d\u7b2cn\u4e2a\u53c2\u6570\u5728\u6700\u4e0a\u9762\uff0c\u7b2c7\u4e2a\u53c2\u6570\u5728\u6808\u9876\uff08\u4e0e\u8fd4\u56de\u5730\u5740\u76f8\u90bb\uff09\u3002\u53e6\u5916\uff0c\u6240\u6709\u6570\u636e\u5927\u5c0f\u90fd\u5411\u4e0a\u53d6\u6574\u4e3a8\u7684\u500d\u6570\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-C",children:"void proc(long a1, long *a1p,\nint a2, long *a2p,\nshort a3, short *a3p,\nchar a4, char *a4p)\n{\n    *a1p += a1;\n    *a2p += a2;\n    *a3p += a3;\n    *a4p += a4;\n}\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-x86asm",children:"proc:\n    movq   16(%rsp), %rax\n    addq   %rdi, (%rsi)\n    addl   %edx, (%rcx)\n    addw   %r8w, (%r9)\n    movl   8(%rsp), %edx\n    addb   %dl, (%rax)\n    ret\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u5bc4\u5b58\u5668\u4f7f\u7528\u7ea6\u5b9a",children:"\u5bc4\u5b58\u5668\u4f7f\u7528\u7ea6\u5b9a"}),"\n",(0,l.jsx)(e.p,{children:"\u5bf9\u4e8e\u67d0\u4e2a\u5bc4\u5b58\u5668\uff0c\u53ea\u5141\u8bb8\u4e00\u4e2a\u51fd\u6570\u6d3b\u52a8\u3002\u5728\u8c03\u7528\u51fd\u6570\u524d\uff0c\u9700\u8981\u4fdd\u5b58\u4f7f\u7528\u7684\u5bc4\u5b58\u5668\u503c\u3002\u53e6\u5916\uff0c\u5728\u5bc4\u5b58\u5668\u5206\u914d\u548c\u4fdd\u5b58\u65f6\uff0c\u53ea\u9700\u8003\u8651\u5b9e\u9645\u4f7f\u7528\u7684\u5bc4\u5b58\u5668\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5bc4\u5b58\u5668\u5206\u4e3a\u88ab\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u548c\u88ab\u88ab\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u6709"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-x86asm",children:"%rax, %rdi, %rsi, %rdx, %rcx, %r8, %r9, %r10, %r11\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u88ab\u8c03\u7528\u7684\u51fd\u6570\u53ef\u4ee5\u968f\u610f\u4f7f\u7528\u8fd9\u4e9b\u5bc4\u5b58\u5668\u3002\u51fd\u6570\u7ed3\u675f\u540e\uff0c\u5982\u679c\u8fd8\u9700\u8981\u4f7f\u7528\u8fd9\u4e9b\u5bc4\u5b58\u5668\uff0c\u9700\u8981\u8fd8\u539f\u8c03\u7528\u51fd\u6570\u4e4b\u524d\u7684\u503c\u3002\u5bc4\u5b58\u5668\u7684\u539f\u503c\u5b58\u50a8\u5728\u8c03\u7528\u8005\u7684\u6808\u4e4b\u540e\uff0c\u7b2c7-n\u4e2a\u53c2\u6570\u4e4b\u524d\uff08\u5373\u8c03\u7528\u51fd\u6570\u76f8\u5173\u7684\u5185\u5bb9\u4e2d\uff0c\u5bc4\u5b58\u5668\u539f\u503c\u5b58\u50a8\u5728\u6808\u6700\u5e95\u7aef\uff09\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u88ab\u8c03\u7528\u8005\uff08\u88ab\u8c03\u7528\u7684\u51fd\u6570\uff09\u4fdd\u5b58\u7684\u5bc4\u5b58\u5668\u6709"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-x86asm",children:"%rbx, %rbp, %r12-15\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u7c7b\u4f3c\u5730\uff0c\u8c03\u7528\u8005\u53ef\u4ee5\u968f\u610f\u4f7f\u7528\u8fd9\u4e9b\u5bc4\u5b58\u5668\u3002\u88ab\u8c03\u7528\u8005\u4f7f\u7528\u4e4b\u524d\u8981\u5c06\u539f\u503c\u5b58\u50a8\uff0c\u51fd\u6570\u7ed3\u675f\u540e\u8fd4\u56de\u3002\u8fd9\u4e9b\u539f\u503c\u5b58\u50a8\u5728\u8fd4\u56de\u5730\u5740\u7684\u4e0b\u9762\uff08\u76f8\u5bf9\u800c\u8a00\u662f\u6808\u7684\u4e0a\u65b9\uff09\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u4f8b\u5982\u5bf9\u4e8e"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-C",children:"long P(long x, long y)\n{\n    long u = Q(x);\n    long v = Q(x);\n    return u + v;\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u5bf9\u5e94\u6c47\u7f16\u4e3a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-x86asm",children:"P:\n    pushq  %rbp\n    pushq  %rbx        # save %rbp & %rbx\n    subq   $8, %rsp\n    movq   %rdi, %rbp\n    movq   %rsi, %rbx  # save x & y\n    call Q\n    movq   %rax, %rbx\n    movq   %rbp, %rdi\n    call Q\n    addq   %rbx, %rax\n    addq   $8, %rsp\n    popq   %rbx\n    popq   %rbp\n    ret\n"})}),"\n",(0,l.jsx)(e.h3,{id:"\u5c40\u90e8\u53d8\u91cf",children:"\u5c40\u90e8\u53d8\u91cf"}),"\n",(0,l.jsxs)(e.p,{children:["\u5c40\u90e8\u53d8\u91cf\u88ab\u50a8\u5b58\u5728\u6808\u4e2d\u3002\u8003\u8651\u5230\u5bc4\u5b58\u5668\u6570\u91cf\u6709\u9650\u3001\u53ef\u80fd\u9700\u8981\u5b58\u50a8\u6570\u636e\u7ed3\u6784\u3001\u9700\u8981\u5730\u5740\u7b49\u539f\u56e0\uff0c\u5c40\u90e8\u53d8\u91cf\u4e0d\u4f1a\u5b58\u50a8\u5728\u5bc4\u5b58\u5668\u91cc\uff0c\u800c\u662f\u5b58\u50a8\u5728\u6808\u4e2d\uff0c\u5bc4\u5b58\u5668\u7684\u4e0b\u65b9\uff08\u6808\u9876\uff09\u3002\u4f7f\u7528\u5c40\u90e8\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u8ba1\u7b97\u5b83\u4eec\u548c ",(0,l.jsx)(e.code,{children:"%rsp"})," \u7684\u76f8\u5bf9\u4f4d\u7f6e\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"\u51fd\u6570\u603b\u7ed3",children:"\u51fd\u6570\u603b\u7ed3"}),"\n",(0,l.jsx)(e.p,{children:"\u8c03\u7528\u51fd\u6570\u65f6\uff0c\u64cd\u4f5c\u5982\u4e0b\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5b58\u50a8\u8c03\u7528\u8005\u8d1f\u8d23\u7684\u5bc4\u5b58\u5668\uff08 ",(0,l.jsx)(e.code,{children:"%eax"})," \u7b49\uff09"]}),"\n",(0,l.jsx)(e.li,{children:"\u5b58\u50a8\u5269\u4f59\u53c2\u6570\uff087-n\uff09"}),"\n",(0,l.jsx)(e.li,{children:"\u4f20\u9012\u524d6\u4e2a\u53c2\u6570"}),"\n",(0,l.jsx)(e.li,{children:"\u5b58\u50a8\u8fd4\u56de\u5730\u5740"}),"\n",(0,l.jsx)(e.li,{children:"\u8c03\u7528\u51fd\u6570"}),"\n",(0,l.jsx)(e.li,{children:"\u5b58\u50a8\u51fd\u6570\u8d1f\u8d23\u7684\u5bc4\u5b58\u5668"}),"\n",(0,l.jsx)(e.li,{children:"\u4e3a\u5c40\u90e8\u53d8\u91cf\u5206\u914d\u7a7a\u95f4"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u8fd4\u56de\u65f6\u64cd\u4f5c\u5982\u4e0b\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u5c06\u8fd4\u56de\u503c\u5b58\u50a8\u5728 ",(0,l.jsx)(e.code,{children:"%rax"})]}),"\n",(0,l.jsx)(e.li,{children:"\u91ca\u653e\u5c40\u90e8\u53d8\u91cf\u83b7\u5f97\u7684\u7a7a\u95f4"}),"\n",(0,l.jsx)(e.li,{children:"\u6062\u590d\u51fd\u6570\u50a8\u5b58\u7684\u5bc4\u5b58\u5668"}),"\n",(0,l.jsxs)(e.li,{children:["\u6267\u884c ",(0,l.jsx)(e.code,{children:"ret"})," \uff0c\u5c06\u8fd4\u56de\u5730\u5740\u51fa\u6808"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u53ef\u4ee5\u770b\u5230\u8fd9\u4e00\u5957\u6d41\u7a0b\u4e4b\u540e\uff0c\u53c2\u65707-n\u4e0e\u8c03\u7528\u8005\u8d1f\u8d23\u7684\u5bc4\u5b58\u5668\u4ecd\u5728\u6808\u4e2d\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"\u9012\u5f52",children:"\u9012\u5f52"}),"\n",(0,l.jsxs)(e.p,{children:["\u5bf9\u4e8e\u9012\u5f52\u51fd\u6570\uff0c\u5c06\u8fd9\u90e8\u5206\u7684\u5185\u5bb9\u4e0e\u4e0a\u4e00\u7bc7\u7b14\u8bb0\u7684 ",(0,l.jsx)(e.code,{children:"jmp"})," \u7ed3\u5408\u3002"]}),"\n",(0,l.jsx)(e.p,{children:"\u5bf9\u4e8e\u8fd9\u4e2a\u9012\u5f52\u51fd\u6570"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-C",children:"long rfact(long n)\n{\n    long result;\n    if (n <= 1) {\n        result = 1;\n    } else {\n        result = n * rfact(n - 1);\n    }\n    return result;\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u5bf9\u5e94\u6c47\u7f16\u4e3a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-x86asm",children:"rfact:\t\t\t\t\n    pushq  %rbx\n    movq   %rdi, %rbx\n    movl   $1, %eax\n    cmpq   $1, %rdi\n    jle    .L35\n    leaq   -1(%rdi), %rdi\n    call   rfact\n    imulq  %rbx, %rax\n.L35\n    popq \t%rbx\n    ret\n"})})]})}function h(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(t,{...n})}):t(n)}},8342:(n,e,r)=>{r.d(e,{A:()=>s});const s=r.p+"assets/images/arguments-3030c61f13a1a05314d8cfa26a816325.png"},7193:(n,e,r)=>{r.d(e,{A:()=>s});const s=r.p+"assets/images/stack frame-e9fc5db57dc9416a9d1b2866aa9dc6b8.png"},8453:(n,e,r)=>{r.d(e,{R:()=>d,x:()=>i});var s=r(6540);const l={},c=s.createContext(l);function d(n){const e=s.useContext(c);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:d(n.components),s.createElement(c.Provider,{value:e},n.children)}}}]);