"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[4694],{3686:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>a,contentTitle:()=>t,default:()=>x,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"CSAPP and SJTU ICS/06 Array and Structure","title":"06 Array and Structure","description":"\u8fd9\u7bc7\u7b14\u8bb0\u4ecb\u7ecdlecture10-11\uff0c\u6c47\u7f16\u4e2d\u7684\u6570\u7ec4\u548c\u6570\u636e\u7ed3\u6784\u3002","source":"@site/docs/CSAPP and SJTU ICS/06 Array and Structure.md","sourceDirName":"CSAPP and SJTU ICS","slug":"/CSAPP and SJTU ICS/06 Array and Structure","permalink":"/docs/CSAPP and SJTU ICS/06 Array and Structure","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CSAPP and SJTU ICS/06 Array and Structure.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"05 function and Array","permalink":"/docs/CSAPP and SJTU ICS/05 function and Array"},"next":{"title":"01 Propositional Logic","permalink":"/docs/SJTU CDM/01 Propositional Logic"}}');var d=n(4848),c=n(8453);const s={sidebar_position:1},t=void 0,a={},l=[{value:"\u6570\u7ec4",id:"\u6570\u7ec4",level:2},{value:"\u6570\u7ec4\u4e0e\u6307\u9488",id:"\u6570\u7ec4\u4e0e\u6307\u9488",level:3},{value:"\u591a\u7ef4\u6570\u7ec4",id:"\u591a\u7ef4\u6570\u7ec4",level:3},{value:"\u56fa\u5b9a\u957f\u5ea6\u6570\u7ec4",id:"\u56fa\u5b9a\u957f\u5ea6\u6570\u7ec4",level:3},{value:"\u4e0d\u56fa\u5b9a\u957f\u5ea6\u6570\u7ec4",id:"\u4e0d\u56fa\u5b9a\u957f\u5ea6\u6570\u7ec4",level:3}];function o(r){const e={code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,c.R)(),...r.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.p,{children:"\u8fd9\u7bc7\u7b14\u8bb0\u4ecb\u7ecdlecture10-11\uff0c\u6c47\u7f16\u4e2d\u7684\u6570\u7ec4\u548c\u6570\u636e\u7ed3\u6784\u3002"}),"\n",(0,d.jsx)(e.h2,{id:"\u6570\u7ec4",children:"\u6570\u7ec4"}),"\n",(0,d.jsx)(e.h3,{id:"\u6570\u7ec4\u4e0e\u6307\u9488",children:"\u6570\u7ec4\u4e0e\u6307\u9488"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-C",children:"T A[N];\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u6570\u7ec4\u58f0\u660e\u8bed\u53e5\u5206\u914d\u4e86\u4e00\u5757\u5927\u5c0f\u4e3a ",(0,d.jsx)(e.code,{children:"sizeof(T) * N"})," \u7684\u7a7a\u95f4\u3002\u6570\u7ec4\u7684\u9996\u5730\u5740\u4e3a ",(0,d.jsx)(e.code,{children:"Xa"})," \uff0c\u662f\u6307\u5411\u6570\u7ec4\u7b2c\u4e00\u4e2a\u6570\u7684\u6307\u9488\uff0c \u4e5f\u662f ",(0,d.jsx)(e.code,{children:"A"})," \u7684\u503c\u3002\u6570\u7ec4\u7684\u4e0b\u6807\u4ece ",(0,d.jsx)(e.code,{children:"0"})," \u5230 ",(0,d.jsx)(e.code,{children:"N - 1"})," \uff0c\u5176\u4e2d\u7b2c ",(0,d.jsx)(e.code,{children:"i"})," \u4e2a\u5143\u7d20\u7684\u5730\u5740\u662f ",(0,d.jsx)(e.code,{children:"Xa + i * sizeof(T)"})," \u3002\u6307\u9488\u52a0\u4e0b\u6807\u5f97\u5230\u53e6\u4e00\u4e2a\u6307\u9488\uff1b\u4e24\u4e2a\u6307\u9488\u76f8\u51cf\u5f97\u5230\u4e00\u4e2a\u6b63\u6570\uff08\u4f8b\u5b50\u4e2d\u4e3a ",(0,d.jsx)(e.code,{children:"long"})," \uff09\u3002"]}),"\n",(0,d.jsxs)(e.p,{children:["\u5728\u6c47\u7f16\u4e2d\uff0c\u82e5 ",(0,d.jsx)(e.code,{children:"A"})," \u7684\u503c\u5b58\u5728 ",(0,d.jsx)(e.code,{children:"%rdx"})," \u4e2d\uff0c\u4e0b\u6807 ",(0,d.jsx)(e.code,{children:"i"})," \u5b58\u5728 ",(0,d.jsx)(e.code,{children:"%rcx"})," \u4e2d\uff0c\u5219\u6570\u7ec4 ",(0,d.jsx)(e.code,{children:"A[i]"})," \u7684\u503c\u5728 ",(0,d.jsx)(e.code,{children:"(%rdx, %rcx, 4)"})," \u3002"]}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{alt:"pointer arithmetic",src:n(7727).A+"",width:"1372",height:"806"})}),"\n",(0,d.jsx)(e.h3,{id:"\u591a\u7ef4\u6570\u7ec4",children:"\u591a\u7ef4\u6570\u7ec4"}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{alt:"nested array",src:n(8916).A+"",width:"491",height:"1039"})}),"\n",(0,d.jsxs)(e.p,{children:["\u5982\u56fe\uff0c\u591a\u7ef4\u6570\u7ec4\u4e5f\u662f\u50cf\u4e00\u4f4d\u6570\u7ec4\u4e00\u6837\u5b58\u50a8\u7684\u3002\u5143\u7d20 ",(0,d.jsx)(e.code,{children:"A[i][j]"})," \u5b58\u50a8\u5728 ",(0,d.jsx)(e.code,{children:"Xd + sizeof(T) * (C * i + j)"})," \uff0c ",(0,d.jsx)(e.code,{children:"C"})," \u662f\u5217\u6570\u3002"]}),"\n",(0,d.jsxs)(e.p,{children:["\u82e5 ",(0,d.jsx)(e.code,{children:"%rdi"})," \u5b58\u50a8 ",(0,d.jsx)(e.code,{children:"Xd"})," \uff0c ",(0,d.jsx)(e.code,{children:"%rsi"})," \u5b58\u50a8 ",(0,d.jsx)(e.code,{children:"i"})," \uff0c ",(0,d.jsx)(e.code,{children:"%rdx"})," \u5b58\u50a8 ",(0,d.jsx)(e.code,{children:"j"})," \uff0c\u5219 ",(0,d.jsx)(e.code,{children:"A[i][j]"})," \u4e3a"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-x86asm",children:"leaq (%rsi, %rsi, 2), %rax\r\nleaq (%rdi, %rax, 4), %rax\r\n(%rdx, %rax, 4)\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u56fa\u5b9a\u957f\u5ea6\u6570\u7ec4",children:"\u56fa\u5b9a\u957f\u5ea6\u6570\u7ec4"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-C",children:"#define N 16\r\ntypedef int fix_matrix[N][N];\r\n\r\n/* Compute i,k of fixed matrix product */\r\nint fix_prod_ele(fix_matrix A, fix_matrix B, long i, long k)\r\n{\r\n    long j;\r\n    int result = 0;\r\n\r\n    for (j = 0; j < N; j++)\r\n        result += A[i][j] * B[j][k];\r\n\r\n    return result;\r\n}\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4f1a\u88ab\u6539\u5199\u4e3a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-C",children:"/* Compute i,k of fixed matrix product */\r\nint fix_prod_ele_opt(fix_matrix A, fix_matrix B, long i, long k)\r\n{\r\n    int *Aptr = &A[i][0], *Bptr = &B[0][k];\r\n    int *Bend = &B[N][k]; \r\n    int result = 0;\r\n    do {\r\n        result += *Aptr * *Bptr;\r\n        Aptr ++;\r\n        Bptr += N;\r\n    } while (Bptr != Bend)\r\n    return result;\r\n}\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u6c47\u7f16\u4e3a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-x86asm",children:"A in %rdi, B in %rsi, i in %rdx, k in %rcx\r\nfix_prod_ele:\r\n    salq \t$6, %rdx\r\n    addq \t%rdx, %rdi\r\n    leaq \t(%rsi,%rcx,4), %rcx\r\n    leaq \t1024(%rcx), %rsi\r\n    movl \t$0, %eax\r\n.L7:\r\n    movl\t(%rdi), %edx\r\n    imull \t(%rcx), %edx\r\n    addl \t%edx, %eax\r\n    addq \t$4, %rdi\r\n    addq \t$64, %rcx\r\n    cmpq \t%rsi, %rcx\r\n    jne\t\t.L7\r\n    rep;\n"})}),"\n",(0,d.jsx)(e.h3,{id:"\u4e0d\u56fa\u5b9a\u957f\u5ea6\u6570\u7ec4",children:"\u4e0d\u56fa\u5b9a\u957f\u5ea6\u6570\u7ec4"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-C",children:"int var_ele(long n, int A[n][n], long i, long j)\r\n  {\r\n      return A[i][j];\r\n  }\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u6570\u7ec4\u7684\u957f\u5ea6\u4f1a\u5728\u5b9a\u4e49\u65f6\u6839\u636e\u53d8\u91cf\u786e\u5b9a\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-x86asm",children:"n at %rdi, A at %rsi, i at %rdx, j at %rcx\r\nvar_ele:\r\n  imulq %rdx, %rd\r\n  leaq  (%rsi,%rdi,4), %rax\r\n  movl  (%rax,%rcx,4), %eax\n"})})]})}function x(r={}){const{wrapper:e}={...(0,c.R)(),...r.components};return e?(0,d.jsx)(e,{...r,children:(0,d.jsx)(o,{...r})}):o(r)}},8916:(r,e,n)=>{n.d(e,{A:()=>i});const i=n.p+"assets/images/nested array-588490ca1ac7670012b70bc52be20fa7.png"},7727:(r,e,n)=>{n.d(e,{A:()=>i});const i=n.p+"assets/images/pointer arithmetic-f78e89a1068beb23db545378b0a2d032.png"},8453:(r,e,n)=>{n.d(e,{R:()=>s,x:()=>t});var i=n(6540);const d={},c=i.createContext(d);function s(r){const e=i.useContext(c);return i.useMemo((function(){return"function"==typeof r?r(e):{...e,...r}}),[e,r])}function t(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(d):r.components||d:s(r.components),i.createElement(c.Provider,{value:e},r.children)}}}]);