"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[7139],{199:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>x,frontMatter:()=>i,metadata:()=>n,toc:()=>t});const n=JSON.parse('{"id":"CSAPP and SJTU ICS/03 Basic Assembly","title":"03 Basic Assembly","description":"\u8fd9\u7bc7\u7b14\u8bb0\u5305\u542blecture6-8\u7684\u5185\u5bb9\uff0c\u4ecb\u7ecd\u4e86\u987a\u5e8f\u7ed3\u6784\u4e0b\u7684x86\u6c47\u7f16\u3001mov\u548cjmp\u3002","source":"@site/docs/CSAPP and SJTU ICS/03 Basic Assembly.md","sourceDirName":"CSAPP and SJTU ICS","slug":"/CSAPP and SJTU ICS/03 Basic Assembly","permalink":"/docs/CSAPP and SJTU ICS/03 Basic Assembly","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CSAPP and SJTU ICS/03 Basic Assembly.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"02 Storage","permalink":"/docs/CSAPP and SJTU ICS/02 Storage"},"next":{"title":"01 Propositional Logic","permalink":"/docs/SJTU CDM/01 Propositional Logic"}}');var d=r(4848),c=r(8453);const i={sidebar_position:1},l=void 0,o={},t=[{value:"\u987a\u5e8f\u7ed3\u6784",id:"\u987a\u5e8f\u7ed3\u6784",level:2},{value:"\u64cd\u4f5c\u6570",id:"\u64cd\u4f5c\u6570",level:3},{value:"\u5bc4\u5b58\u5668",id:"\u5bc4\u5b58\u5668",level:3},{value:"\u5185\u5b58",id:"\u5185\u5b58",level:3},{value:"\u6c47\u7f16\u4ee3\u7801",id:"\u6c47\u7f16\u4ee3\u7801",level:3}];function a(e){const s={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.p,{children:"\u8fd9\u7bc7\u7b14\u8bb0\u5305\u542blecture6-8\u7684\u5185\u5bb9\uff0c\u4ecb\u7ecd\u4e86\u987a\u5e8f\u7ed3\u6784\u4e0b\u7684x86\u6c47\u7f16\u3001mov\u548cjmp\u3002"}),"\n",(0,d.jsx)(s.h2,{id:"\u987a\u5e8f\u7ed3\u6784",children:"\u987a\u5e8f\u7ed3\u6784"}),"\n",(0,d.jsx)(s.h3,{id:"\u64cd\u4f5c\u6570",children:"\u64cd\u4f5c\u6570"}),"\n",(0,d.jsx)(s.p,{children:"\u64cd\u4f5c\u6570\u6709\u4e09\u79cd\u8868\u793a\u65b9\u5f0f\uff1a"}),"\n",(0,d.jsxs)(s.ul,{children:["\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"%rax"})," \uff1a\u5bc4\u5b58\u5668"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"8(%rbx)"})," \uff1a\u5185\u5b58"]}),"\n",(0,d.jsxs)(s.li,{children:[(0,d.jsx)(s.code,{children:"$4"})," \uff1a\u7acb\u5373\u6570"]}),"\n"]}),"\n",(0,d.jsx)(s.p,{children:"\u4f8b\u5982\u5bf9\u4e8e\u8fd9\u6bb5c\u4ee3\u7801"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-C",children:"*dest = t;\r\n*dest += 4;\n"})}),"\n",(0,d.jsx)(s.p,{children:"\u5bf9\u5e94\u7684\u6c47\u7f16\u4e3a"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-x86asm",children:"movq %rax, (%rbx)\r\naddq $4, (%rbx)\n"})}),"\n",(0,d.jsx)(s.h3,{id:"\u5bc4\u5b58\u5668",children:"\u5bc4\u5b58\u5668"}),"\n",(0,d.jsx)(s.p,{children:"\u83b7\u53d6\u5bc4\u5b58\u5668\u4e2d\u7684\u6570\u636e\u6bd4\u5185\u5b58\u5757\uff0c\u4f46\u5185\u5b58\u5668\u6570\u91cf\u8f83\u5c11\uff0c\u5e76\u6709\u56fa\u5b9a\u7684\u540d\u5b57\u3002"}),"\n",(0,d.jsx)(s.p,{children:"\u6574\u578b\u5bc4\u5b58\u5668\uff088\u5b57\u8282\uff09\uff1a"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"int register 1",src:r(6197).A+"",width:"1108",height:"758"})}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"int register 2",src:r(8366).A+"",width:"1115",height:"736"})}),"\n",(0,d.jsx)(s.p,{children:"\u6d6e\u70b9\u578b\u5bc4\u5b58\u5668\uff0832\u5b57\u8282\uff09\uff1a"}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"float register 1",src:r(2898).A+"",width:"987",height:"756"})}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"float register 2",src:r(9481).A+"",width:"1100",height:"821"})}),"\n",(0,d.jsx)(s.p,{children:"\u6ce8\u610f\u4e0d\u540c\u5bc4\u5b58\u5668\u7684\u4f4d\u6570\u53ef\u80fd\u4e0d\u540c\u3002"}),"\n",(0,d.jsxs)(s.p,{children:["\u5bf9\u4e8e\u540d\u4e3a ",(0,d.jsx)(s.code,{children:"%rax"})," \u7684\u5bc4\u5b58\u5668\uff0c\u5b58\u50a8\u7684\u5185\u5bb9\u5199\u4f5c ",(0,d.jsx)(s.code,{children:"R[ra]"})," \u3002"]}),"\n",(0,d.jsx)(s.h3,{id:"\u5185\u5b58",children:"\u5185\u5b58"}),"\n",(0,d.jsxs)(s.p,{children:["\u865a\u62df\u7a7a\u95f4\u662f\u4e00\u4e2a\u7ebf\u6027\u7684\u6570\u7ec4\uff0c\u4e0b\u6807\u4ece0\u5f00\u59cb\u3002",(0,d.jsx)(s.code,{children:"M"})," \u4e3a\u6570\u7ec4\u540d\uff0c",(0,d.jsx)(s.code,{children:"addr"})," \u4e3a\u5185\u5b58\u5730\u5740\uff0c",(0,d.jsx)(s.code,{children:"M[addr]"})," \u662f\u4eceaddr\u5730\u5740\u5f00\u59cb\u7684\u5185\u5b58\u5185\u5bb9\u3002"]}),"\n",(0,d.jsxs)(s.p,{children:["\u7d22\u5f15\u5bfb\u5740\u662f\u4e00\u4e2a\u8ba1\u7b97\u5730\u5740\u7684\u8868\u8fbe\u5f0f\uff0c\u5e38\u89c1\u7684\u683c\u5f0f\u662f ",(0,d.jsx)(s.code,{children:"Imm(rb, ri, s)"}),"\u3002 ",(0,d.jsx)(s.code,{children:"Imm"})," \u4e3a\u7acb\u5373\u6570\uff0c\u9ed8\u8ba4\u4e3a\u5341\u8fdb\u5236\u3002 ",(0,d.jsx)(s.code,{children:"rb"})," \u548c ",(0,d.jsx)(s.code,{children:"ri"})," \u90fd\u662f64\u4f4d\u6574\u578b\u5bc4\u5b58\u5668\uff0c\u5206\u522b\u4e3a\u57fa\u5740\u5bc4\u5b58\u5668\uff08base register\uff09\u548c\u7d22\u5f15\u5bc4\u5b58\u5668\uff08index register\uff09\u3002 ",(0,d.jsx)(s.code,{children:"s"})," \u662f\u7f29\u653e\u56e0\u5b50\uff0c\u4e3a1\u30012\u30014\u62168\u3002\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u4ee3\u8868\u7684\u5730\u5740\u662f ",(0,d.jsx)(s.code,{children:"Imm + R[rb] + R[ri] * s"})," \uff0c\u5b58\u50a8\u7684\u503c\u5728 ",(0,d.jsx)(s.code,{children:"M[Imm + R[rb] + R[ri] * s]"})," \u4e2d\u3002"]}),"\n",(0,d.jsxs)(s.p,{children:["\u5728\u6c47\u7f16\u4e2d\uff0c\u8981\u52a0 ",(0,d.jsx)(s.code,{children:"$"})," \u624d\u8868\u793a\uff08\u5355\u72ec\u7684\uff09\u7acb\u5373\u6570\uff0c\u5426\u5219\u4f1a\u88ab\u8bc6\u522b\u4e3a\u5730\u5740\u3002\u5bf9\u4e8e\u5bc4\u5b58\u5668\uff08\u4ee5 ",(0,d.jsx)(s.code,{children:"%rax"})," \u4e3a\u4f8b\uff09\uff0c ",(0,d.jsx)(s.code,{children:"%rax"})," \u8868\u793a\u5bc4\u5b58\u5668\u5b58\u50a8\u7684\u503c\uff0c ",(0,d.jsx)(s.code,{children:"(%rax)"})," \u8868\u793a\u5b58\u50a8\u7684\u5730\u5740\u6307\u5411\u7684\u503c\u3002 ",(0,d.jsx)(s.code,{children:"Imm(rb, ri)"})," \u7684\u5199\u6cd5\u4e3a ",(0,d.jsx)(s.code,{children:"Imm(%rb, %ri)"}),"\uff0c\u8868\u793a ",(0,d.jsx)(s.code,{children:"M[Imm + R[rb] + R[ri]]"})," \uff1b",(0,d.jsx)(s.code,{children:"(rb, ri, s)"})," \u7684\u5199\u6cd5\u4e3a ",(0,d.jsx)(s.code,{children:"(%rb, %ri, s)"}),"\uff0c \u8868\u793a ",(0,d.jsx)(s.code,{children:"M[Imm + R[rb] + R[ri] * s]"})," \u3002"]}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.img,{alt:"addressing mode",src:r(1981).A+"",width:"1486",height:"1248"})}),"\n",(0,d.jsx)(s.h3,{id:"\u6c47\u7f16\u4ee3\u7801",children:"\u6c47\u7f16\u4ee3\u7801"}),"\n",(0,d.jsxs)(s.p,{children:["\u8ba1\u7b97\u673a\u67b6\u6784\u4e2d\uff0c ",(0,d.jsx)(s.code,{children:"%rip"})," \u662f\u6307\u9488\u6307\u4ee4\u5bc4\u5b58\u5668\uff08program counter\uff0cPC\uff09\u3002\u5728CPU\u6267\u884c\u67d0\u6761\u6307\u4ee4\u65f6\uff0c\u5b83\u4f1a\u6307\u5411\u5f53\u524d\u6307\u4ee4\u7684\u5730\u5740\uff0c\u5728\u6267\u884c\u7ed3\u675f\u540e\u81ea\u52a8\u5207\u6362\u5230\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740\u3002 ",(0,d.jsx)(s.code,{children:"%eflags"})," \u662f\u72b6\u6001\u5bc4\u5b58\u5668\uff08\u6216\u6807\u5fd7\u5bc4\u5b58\u5668\uff0cconditional code register\uff09\uff0c\u5b58\u50a8\u6700\u8fd1\u6267\u884c\u6307\u4ee4\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u53ef\u4ee5\u7528\u6765\u5b9e\u73b0\u63a7\u5236\u6d41\u3002"]}),"\n",(0,d.jsxs)(s.p,{children:[(0,d.jsx)(s.code,{children:"gcc -c"})," \u53ef\u7528\u6765\u751f\u6210\u6c47\u7f16\u6587\u4ef6\u3002\u4e5f\u53ef\u4ee5\u751f\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6\u540e\uff0c\u7528 ",(0,d.jsx)(s.code,{children:"objdump  -d"})," \u53cd\u751f\u6210\u6c47\u7f16\u6587\u4ef6\u3002"]}),"\n",(0,d.jsx)(s.p,{children:"\u5728\u6267\u884c\u6587\u4ef6\u65f6\uff0cPC\u5b58\u50a8\u4e86\u6307\u4ee4\u7684\u5730\u5740\uff0c\u673a\u5668\u6267\u884c\u4e4b\u540e\u589e\u52a0PC\u3002"}),"\n",(0,d.jsx)(s.p,{children:"\u4e00\u6bb5\u987a\u5e8f\u7ed3\u6784\u7684\u4ee3\u7801\u5982\u4e0b"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-C",children:"long mult2(long, long);\r\n\r\nvoid multstore(long x, long y, long *dest)\r\n{\r\n    long t = mult2(x, y);\r\n    *dest = t;\r\n}\n"})}),"\n",(0,d.jsx)(s.p,{children:"\u5bf9\u5e94\u7684\u6c47\u7f16\u4ee3\u7801\u4e3a"}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-x86asm",children:"multstore:\r\n    pushq %rbx\r\n    moveq %rdx, %rbx\r\n    call mult2\r\n    moveq %rax, (%rbx)\r\n    popq %rbx\r\n    ret\n"})}),"\n",(0,d.jsxs)(s.p,{children:["\u5728\u51fd\u6570\u5f00\u59cb\u524d\uff0cmultstore\u7684\u4e09\u4e2a\u53c2\u6570\u5206\u522b\u5b58\u50a8\u5728 ",(0,d.jsx)(s.code,{children:"%rdi"})," \u3001 ",(0,d.jsx)(s.code,{children:"%rsi"})," \u3001 ",(0,d.jsx)(s.code,{children:"%rdx"})," \u4e2d\u3002 ",(0,d.jsx)(s.code,{children:"pushq"})," \u5c06 ",(0,d.jsx)(s.code,{children:"%rbx"})," \u7684\u503c\u538b\u5165\u6808\u4e2d\uff0c\u51c6\u5907\u4ee5\u540e\u53ef\u80fd\u4f7f\u7528\u539f ",(0,d.jsx)(s.code,{children:"%rbx"})," \u7684\u503c\u3002 ",(0,d.jsx)(s.code,{children:"moveq"})," \u5c06 ",(0,d.jsx)(s.code,{children:"%rdx"})," \u7684\u503c\u653e\u5728 ",(0,d.jsx)(s.code,{children:"%rbx"})," \u4e2d\uff0c\u7136\u540e\u8c03\u7528 ",(0,d.jsx)(s.code,{children:"mult2"})," \u51fd\u6570\u3002\u8c03\u7528\u540e\u7684 ",(0,d.jsx)(s.code,{children:"moveq"})," \u5c06 ",(0,d.jsx)(s.code,{children:"%rax"})," \u8fd4\u56de\u503c\u5b58\u5165 ",(0,d.jsx)(s.code,{children:"%rbx"})," \u6307\u5411\u7684\u4f4d\u7f6e\u3002 ",(0,d.jsx)(s.code,{children:"popq"})," \u5f39\u51fa\u6808\u4e2d\u7684\u503c\u5e76\u5b58\u50a8\u5230 ",(0,d.jsx)(s.code,{children:"%rbx"})," \u4e2d\u3002\u6700\u540e\uff0c ",(0,d.jsx)(s.code,{children:"ret"})," \u7ed3\u675f\u51fd\u6570\uff0c\u8fd4\u56de\u3002"]})]})}function x(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,d.jsx)(s,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},1981:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/addressing mode-e1bf733b03313785508ba6269400c764.png"},2898:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/float register 1-f24b68513f940791b5f2835be0dff7cf.png"},9481:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/float register 2-53d9cf80460e4247890eb7e9e99768ca.png"},6197:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/int register 1-82fd982899bbe6224e0ac0ca7d2a6e66.png"},8366:(e,s,r)=>{r.d(s,{A:()=>n});const n=r.p+"assets/images/int register 2-2cc9a4f53a987940d53efd022b6c4ec0.png"},8453:(e,s,r)=>{r.d(s,{R:()=>i,x:()=>l});var n=r(6540);const d={},c=n.createContext(d);function i(e){const s=n.useContext(c);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),n.createElement(c.Provider,{value:s},e.children)}}}]);